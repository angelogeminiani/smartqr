
(function(window, SF, $, undefined) { 
    
    // ------------------------------------------------------------------------
    //                      LIBRARY LOAD
    //                      
    //                      dependencies:
    //                          sf-base.js
    //                          sf-base_loaders.js
    //                      uses:
    //                          
    // ------------------------------------------------------------------------
    
    /**
     * Singleton pattern (MODULE PATTERN)
     * see: http://www.yuiblog.com/blog/2007/06/12/module-pattern/
     */
    SF.lib = SF.lib||(function(){
        var _libs = new Array();
        
        function getKey(filename){
            var result = SF.replaceAll(filename, "/", " ").trim();
            return SF.replaceAll(result, " ", "_");
        }
        
        function notExists(filename){
            return _libs.indexOf(getKey(filename))===-1;
        }
        
        function addLib(filename){
            _libs.push(getKey(filename));
        }
        
        return {    // public
            /**
             * Load file library (js, css) and flag as loaded
             */
            require : function(/*string*/ filename){
                try{
                    if( notExists(filename) ){
                        // load lib
                        if(SF.endsWith(filename, ".js")){
                            SF.script.load(filename);
                        } else if (SF.endsWith(filename, ".css")){
                            SF.css.load(filename);
                        } else {
                            throw "Unsupported file type: " + filename;
                        }
                        // add to _libs
                        addLib(filename);
                    }
                }catch(err){
                    // throw "Unespected error: " + err;
                    SF.error(err);
                }
            },
            
            /**
             * Does not load a library, but flag it as already loaded.
             * This is useful for debug porpouse, when libraries are loaded
             * explicitely from HTML declarations.
             **/
            loaded: function(filename){
                try{
                    if( notExists(filename) ){
                        // add to _libs
                        addLib(filename);
                    }
                }catch(err){
                    //throw "Unespected error: " + err;
                    SF.error(err);
                }
            }
        }
    })();
        
    
    // ------------------------------------------------------------------------
    //                      Helpers
    // ------------------------------------------------------------------------
    
    /**
     * JQuery DatePicker helper method to load localizations
     */
    SF.lib.datepicker = SF.lib.datepicker||{};
    SF.lib.datepicker.regional = function (opt_lang){
        var 
        langCode = opt_lang||SF.lang,
        url ="http://jquery-ui.googlecode.com/svn/trunk/ui/i18n/jquery.ui.datepicker-"+langCode+".js" ;
        SF.lib.require(url);
    }
    
})(window, smartforge, jQuery);
